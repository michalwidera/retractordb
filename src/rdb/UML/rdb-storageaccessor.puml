@startuml

title Storage Accessor - Activty Diagram


start

:storageAccessor(filename,[descriptorParam]) ;
note right: Crete storageAccessor class instance

:assume descriptor as filename.desc;

if (descriptor file exists?) then (yes)
  :read descriptor file;
  if (exist descriptorParam &&descriptor == descriptorParam)
    if (descriptor has ref?) then (yes)
      :storage location from ref;
    else (no)
      :default storage ref;
    endif
  else
    :<color:red>ERROR - differnet descriptors;
    stop
  endif
else (no)
  :default storage ref;
  :create and store
  descriptor file;
endif

:<color:green>descriptor is ready;

if (storage file exists?) then (yes)
  :attach storage;
  note left: compute storage size
else (no)
  :create storage;
endif

:<color:green>storage is ready;

:<color:green>attach payload;

stop

@enduml